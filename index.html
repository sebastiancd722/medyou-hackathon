<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MedYou - Patient Portal</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon" aria-hidden="true">üíä</div>
        <h1>MedYou</h1>
      </div>
      
      <div class="user-menu-container">
        <button class="user-profile-btn" id="user-menu-btn" onclick="toggleAccountMenu()" aria-haspopup="true" aria-expanded="false" aria-label="Account menu">
          <span id="user-name-display">Loading...</span>
          <div class="avatar" id="user-avatar-display" aria-hidden="true">--</div>
          <span class="dropdown-arrow">‚ñº</span>
        </button>

        <div id="account-dropdown" class="account-dropdown hidden" role="menu" aria-labelledby="user-menu-btn">
          <button class="menu-item" role="menuitem" onclick="handleMenuAction('account')">My Account</button>
          <button class="menu-item" role="menuitem" onclick="handleMenuAction('settings')">Profile & Settings</button>
          <button class="menu-item" role="menuitem" onclick="openAvatarModal()">Change Avatar</button>
          <div class="menu-divider"></div>
          <button class="menu-item text-red" role="menuitem" onclick="handleMenuAction('logout')">Sign Out (Demo)</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <nav class="app-tabs" role="tablist">
      <button class="tab-btn active" onclick="switchTab('dashboard')" id="tab-dashboard-btn" role="tab" aria-selected="true">Today</button>
      <button class="tab-btn" onclick="switchTab('browse')" id="tab-browse-btn" role="tab" aria-selected="false">Browse Medications</button>
    </nav>

    <section class="today-summary">
      <div class="summary-card">
        <div class="summary-icon-wrapper bg-blue">
          <span class="summary-icon">üìä</span>
        </div>
        <div class="summary-text">
          <span class="summary-label">Doses left today</span>
          <span class="summary-value" id="summary-doses">--</span>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon-wrapper bg-orange">
          <span class="summary-icon">‚ö†Ô∏è</span>
        </div>
        <div class="summary-text">
          <span class="summary-label">Low on pills</span>
          <span class="summary-value" id="summary-low-stock">--</span>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon-wrapper bg-teal">
          <span class="summary-icon">üí¨</span>
        </div>
        <div class="summary-text">
          <span class="summary-label">Discussion items</span>
          <span class="summary-value" id="summary-discussion">--</span>
        </div>
      </div>
    </section>

    <div id="view-dashboard">
      <div class="daily-grid">
        <section class="card-column">
          <div class="section-header">
            <h2>My Medications</h2>
            <p class="subtitle">Manage your active prescriptions and refills.</p>
          </div>
          <div id="med-card-container">
            </div>
        </section>

        <section class="schedule-column">
          <div class="section-header flex-between">
            <div>
              <h2>Today's Schedule</h2>
              <p class="subtitle">Track your daily adherence.</p>
            </div>
            <div class="toggle-wrapper">
              <span class="toggle-label">Show remaining</span>
              <label class="switch">
                <input type="checkbox" id="toggle-remaining" onchange="toggleScheduleFilter()">
                <span class="slider round"></span>
              </label>
            </div>
          </div>

          <div class="adherence-score-box">
            <div class="score-info">
              <span class="score-label">Adherence Score</span>
              <span class="next-dose-label" id="next-dose-display">All caught up!</span>
            </div>
            <span class="score-value" id="adherence-display">--%</span>
          </div>

          <div id="dose-list" role="list">
            </div>
        </section>
      </div>

      <section class="weekly-dashboard">
        <div class="history-module">
          <div class="section-header">
            <h2>Last 7 Days</h2>
            <p class="subtitle" id="history-summary">Loading stats...</p>
          </div>
          <div id="history-chart" class="history-chart">
            </div>
        </div>

        <div class="forecast-module">
          <div class="section-header">
            <h2>Next 7 Days</h2>
            <p class="subtitle">Upcoming dose schedule.</p>
            <p class="subtitle-small">Based on your current prescriptions</p>
          </div>
          <div id="forecast-grid" class="forecast-grid">
            </div>
        </div>
      </section>
    </div>

    <div id="view-browse" class="hidden">
      <div class="browse-container">
        <aside class="browse-sidebar">
          <h3>Conditions</h3>
          <div id="category-list">
            </div>
        </aside>

        <div class="browse-content">
          <div class="section-header">
            <h2 id="browse-title">Diabetes</h2>
            <p class="subtitle" id="browse-user-context"></p>
            <p class="subtitle-small">Educational information only. Not medical advice.</p>
          </div>

          <div class="catalog-controls">
            <div class="search-wrapper">
              <span class="search-icon">üîç</span>
              <input type="text" id="catalog-search" placeholder="Search medications in this category..." onkeyup="renderCatalog()">
            </div>
          </div>

          <div id="catalog-grid" class="catalog-grid">
            </div>
        </div>
      </div>

      <div class="discussion-panel">
        <div class="discussion-header flex-between">
          <div>
            <h3>üìù My Discussion List <span id="discussion-count" class="count-badge">(0)</span></h3>
            <p class="subtitle">Items to discuss with your doctor or pharmacist.</p>
          </div>
          <button class="btn-text-small" onclick="clearDiscussionList()">Clear all</button>
        </div>
        <ul id="discussion-list-ul">
          <li class="empty-msg">
            <span style="font-size: 1.5rem; display:block; margin-bottom: 0.5rem;">üìã</span>
            Your list is empty. Browse medications to add items.
          </li>
        </ul>
        <p class="disclaimer-small">Disclaimer: This list is for your personal reference only and does not constitute a prescription request.</p>
      </div>
    </div>

  </main>

  <div id="info-modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-instructions">
    <div class="modal-content">
      <div class="modal-header-image">
        <div class="pill-bottle-icon">üíä</div>
      </div>
      <h3 id="modal-title">Medication Name</h3>
      <div class="modal-body">
        <p id="modal-instructions"></p>
        <div class="pharmacist-note-box">
          <strong>Pharmacist Note:</strong>
          <p id="modal-note"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button id="close-modal-btn" class="btn-secondary" aria-label="Close details">Close</button>
      </div>
    </div>
  </div>

  <div id="avatar-modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="avatar-modal-title">
    <div class="modal-content">
      <h3 id="avatar-modal-title">Customize Avatar</h3>
      <div class="modal-body">
        <p class="subtitle">Choose a color theme:</p>
        <div class="color-picker-grid">
          <button class="color-swatch" style="background-color: var(--teal)" onclick="selectAvatarColor('var(--teal)')" aria-label="Teal"></button>
          <button class="color-swatch" style="background-color: var(--red)" onclick="selectAvatarColor('var(--red)')" aria-label="Red"></button>
          <button class="color-swatch" style="background-color: #8e44ad" onclick="selectAvatarColor('#8e44ad')" aria-label="Purple"></button>
          <button class="color-swatch" style="background-color: #27ae60" onclick="selectAvatarColor('#27ae60')" aria-label="Green"></button>
          <button class="color-swatch" style="background-color: #e67e22" onclick="selectAvatarColor('#e67e22')" aria-label="Orange"></button>
          <button class="color-swatch" style="background-color: #34495e" onclick="selectAvatarColor('#34495e')" aria-label="Dark Blue"></button>
        </div>
        <div style="margin-top: 1.5rem;">
          <label for="avatar-initials-input" class="input-label">Initials (2 chars):</label>
          <input type="text" id="avatar-initials-input" maxlength="2" class="styled-input">
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeAvatarModal()" class="btn-secondary" style="margin-right: 10px;">Cancel</button>
        <button onclick="saveAvatarSettings()" class="btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <div class="demo-controls">
    <button onclick="loginUser(1)" aria-label="Load demo patient Alex">Alex</button>
    <button onclick="loginUser(2)" aria-label="Load demo patient Sarah">Sarah</button>
    <button onclick="clearDemoData()" aria-label="Reset demo data">Reset</button>
  </div>

  <div id="toast" class="toast hidden" role="alert" aria-live="polite"></div>

  <script src="script.js"></script>
</body>
</html>
